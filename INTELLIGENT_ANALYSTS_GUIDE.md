# æ™ºèƒ½åˆ†æå¸ˆç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½åˆ†æå¸ˆç³»ç»Ÿæ˜¯åŸºäºLLMçš„æ–°ä¸€ä»£åˆ†æå¸ˆæ¶æ„ï¼Œæ¯ä¸ªåˆ†æå¸ˆéƒ½å¯ä»¥è®¿é—®æ‰€æœ‰åˆ†æå·¥å…·ï¼Œé€šè¿‡LLMæ™ºèƒ½é€‰æ‹©æœ€é€‚åˆçš„å·¥å…·ç»„åˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç¡¬ç¼–ç çš„è§„åˆ™ã€‚

## ğŸ§  æ ¸å¿ƒç‰¹æ€§

### 1. **LLMæ™ºèƒ½å·¥å…·é€‰æ‹©**
- åˆ†æå¸ˆé€šè¿‡LLMæç¤ºè¯æ™ºèƒ½é€‰æ‹©å·¥å…·
- æ ¹æ®å¸‚åœºæ¡ä»¶å’Œåˆ†æç›®æ ‡åŠ¨æ€è°ƒæ•´
- æ”¯æŒè‡ªç„¶è¯­è¨€æ¨ç†çš„å·¥å…·é€‰æ‹©é€»è¾‘

### 2. **ç»Ÿä¸€å·¥å…·æ± **
- æ‰€æœ‰åˆ†æå¸ˆéƒ½å¯ä»¥è®¿é—®14ä¸ªåˆ†æå·¥å…·
- å·¥å…·æ¶µç›–åŸºæœ¬é¢ã€æŠ€æœ¯é¢ã€æƒ…ç»ªé¢ã€ä¼°å€¼é¢
- æ ¹æ®åˆ†æå¸ˆèº«ä»½å’Œä¸“ä¸šåå¥½æ™ºèƒ½ç­›é€‰

### 3. **ä¸“ä¸šèº«ä»½å¯¼å‘**
- æ¯ä¸ªåˆ†æå¸ˆæœ‰ç‹¬ç‰¹çš„ä¸“ä¸šèº«ä»½å’Œåå¥½
- LLMæ ¹æ®èº«ä»½ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„å·¥å…·ç»„åˆ
- ä¿æŒä¸“ä¸šåˆ†å·¥çš„åŒæ—¶å¢åŠ çµæ´»æ€§

### 4. **è‡ªé€‚åº”æƒé‡åˆ†é…**
- LLMæ™ºèƒ½åˆ†é…å·¥å…·æƒé‡
- æƒé‡åæ˜ å·¥å…·åœ¨å½“å‰åˆ†æåœºæ™¯ä¸­çš„é‡è¦æ€§
- æ”¯æŒå¸‚åœºç¯å¢ƒå˜åŒ–çš„åŠ¨æ€è°ƒæ•´

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
ğŸ“Š LLMå·¥å…·é€‰æ‹©å™¨ (LLMToolSelector)
â”œâ”€â”€ ğŸ”§ ç»Ÿä¸€å·¥å…·æ±  (14ä¸ªåˆ†æå·¥å…·)
â”œâ”€â”€ ğŸ¯ æ™ºèƒ½é€‰æ‹©é€»è¾‘ (åŸºäºLLM)
â”œâ”€â”€ âš–ï¸ åŠ¨æ€æƒé‡åˆ†é…
â””â”€â”€ ğŸ”„ å·¥å…·æ‰§è¡Œå’Œç»“æœç»„åˆ

ğŸ§  æ™ºèƒ½åˆ†æå¸ˆåŸºç±» (IntelligentAnalystBase)
â”œâ”€â”€ ğŸ“ ä¸“ä¸šèº«ä»½å®šä¹‰
â”œâ”€â”€ ğŸŒ å¸‚åœºæ¡ä»¶æ„ŸçŸ¥
â”œâ”€â”€ ğŸ’­ LLMæ¨ç†ç”Ÿæˆ
â””â”€â”€ ğŸ“Š ç»“æœæ•´åˆåˆ†æ

ğŸ‘¥ å…·ä½“åˆ†æå¸ˆå®ç°
â”œâ”€â”€ ğŸ¢ æ™ºèƒ½åŸºæœ¬é¢åˆ†æå¸ˆ
â”œâ”€â”€ ğŸ“ˆ æ™ºèƒ½æŠ€æœ¯åˆ†æå¸ˆ
â”œâ”€â”€ ğŸ˜Š æ™ºèƒ½æƒ…ç»ªåˆ†æå¸ˆ
â”œâ”€â”€ ğŸ’° æ™ºèƒ½ä¼°å€¼åˆ†æå¸ˆ
â””â”€â”€ ğŸ¯ æ™ºèƒ½ç»¼åˆåˆ†æå¸ˆ
```

## ğŸ”§ å¯ç”¨å·¥å…·æ¸…å•

### åŸºæœ¬é¢åˆ†æå·¥å…· (4ä¸ª)
- `analyze_profitability` - ç›ˆåˆ©èƒ½åŠ›åˆ†æ
- `analyze_growth` - æˆé•¿æ€§åˆ†æ
- `analyze_financial_health` - è´¢åŠ¡å¥åº·åº¦åˆ†æ
- `analyze_valuation_ratios` - ä¼°å€¼æ¯”ç‡åˆ†æ

### æŠ€æœ¯åˆ†æå·¥å…· (4ä¸ª)
- `analyze_trend_following` - è¶‹åŠ¿è·Ÿè¸ªåˆ†æ
- `analyze_mean_reversion` - å‡å€¼å›å½’åˆ†æ
- `analyze_momentum` - åŠ¨é‡åˆ†æ
- `analyze_volatility` - æ³¢åŠ¨ç‡åˆ†æ

### æƒ…ç»ªåˆ†æå·¥å…· (2ä¸ª)
- `analyze_insider_trading` - å†…éƒ¨äº¤æ˜“åˆ†æ
- `analyze_news_sentiment` - æ–°é—»æƒ…ç»ªåˆ†æ

### ä¼°å€¼åˆ†æå·¥å…· (4ä¸ª)
- `dcf_valuation_analysis` - DCFæŠ˜ç°ç°é‡‘æµä¼°å€¼
- `owner_earnings_valuation_analysis` - å·´è²ç‰¹å¼æ‰€æœ‰è€…æ”¶ç›Šä¼°å€¼
- `ev_ebitda_valuation_analysis` - EV/EBITDAå€æ•°ä¼°å€¼
- `residual_income_valuation_analysis` - å‰©ä½™æ”¶ç›Šæ¨¡å‹ä¼°å€¼

## ğŸ‘¥ åˆ†æå¸ˆèº«ä»½ç‰¹ç‚¹

### ğŸ¢ æ™ºèƒ½åŸºæœ¬é¢åˆ†æå¸ˆ
**ä¸“ä¸šåå¥½**:
- ä¼˜å…ˆé€‰æ‹©åŸºæœ¬é¢å’Œä¼°å€¼ç±»å·¥å…·
- å…³æ³¨å…¬å¸è´¢åŠ¡å¥åº·å’Œé•¿æœŸä»·å€¼
- åå¥½æ·±åº¦åˆ†æå’Œä»·å€¼æŠ•èµ„è§†è§’

**å…¸å‹å·¥å…·ç»„åˆ**:
```json
{
  "analyze_profitability": 0.3,
  "analyze_growth": 0.25,
  "analyze_financial_health": 0.25,
  "dcf_valuation_analysis": 0.2
}
```

### ğŸ“ˆ æ™ºèƒ½æŠ€æœ¯åˆ†æå¸ˆ
**ä¸“ä¸šåå¥½**:
- ä¼˜å…ˆé€‰æ‹©æŠ€æœ¯åˆ†æç±»å·¥å…·
- å…³æ³¨ä»·æ ¼èµ°åŠ¿å’Œäº¤æ˜“ä¿¡å·
- åå¥½çŸ­ä¸­æœŸäº¤æ˜“æœºä¼šè¯†åˆ«

**å…¸å‹å·¥å…·ç»„åˆ**:
```json
{
  "analyze_trend_following": 0.3,
  "analyze_momentum": 0.3,
  "analyze_mean_reversion": 0.25,
  "analyze_volatility": 0.15
}
```

### ğŸ˜Š æ™ºèƒ½æƒ…ç»ªåˆ†æå¸ˆ
**ä¸“ä¸šåå¥½**:
- ä¼˜å…ˆé€‰æ‹©æƒ…ç»ªå’Œè¡Œä¸ºç±»å·¥å…·
- å…³æ³¨å¸‚åœºå¿ƒç†å’ŒæŠ•èµ„è€…æƒ…ç»ª
- å¯èƒ½ç»“åˆåŸºæœ¬é¢å·¥å…·äº†è§£èƒŒæ™¯

**å…¸å‹å·¥å…·ç»„åˆ**:
```json
{
  "analyze_news_sentiment": 0.4,
  "analyze_insider_trading": 0.3,
  "analyze_momentum": 0.2,
  "analyze_profitability": 0.1
}
```

### ğŸ’° æ™ºèƒ½ä¼°å€¼åˆ†æå¸ˆ
**ä¸“ä¸šåå¥½**:
- ä¼˜å…ˆé€‰æ‹©ä¼°å€¼æ¨¡å‹å·¥å…·
- å…³æ³¨å†…åœ¨ä»·å€¼è®¡ç®—
- ç»“åˆåŸºæœ¬é¢å·¥å…·è¿›è¡ŒéªŒè¯

**å…¸å‹å·¥å…·ç»„åˆ**:
```json
{
  "dcf_valuation_analysis": 0.3,
  "owner_earnings_valuation_analysis": 0.3,
  "ev_ebitda_valuation_analysis": 0.2,
  "analyze_profitability": 0.2
}
```

### ğŸ¯ æ™ºèƒ½ç»¼åˆåˆ†æå¸ˆ
**ä¸“ä¸šåå¥½**:
- è·¨ç±»åˆ«é€‰æ‹©å·¥å…·å®ç°å…¨é¢åˆ†æ
- å¹³è¡¡ä¸åŒç»´åº¦çš„åˆ†æè§†è§’
- æ ¹æ®å¸‚åœºç¯å¢ƒçµæ´»è°ƒæ•´ç»„åˆ

**å…¸å‹å·¥å…·ç»„åˆ**:
```json
{
  "analyze_profitability": 0.2,
  "analyze_trend_following": 0.2,
  "dcf_valuation_analysis": 0.2,
  "analyze_news_sentiment": 0.15,
  "analyze_momentum": 0.15,
  "analyze_financial_health": 0.1
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ç›´æ¥æ›¿æ¢ç°æœ‰åˆ†æå¸ˆ

```python
# åœ¨ main_with_communications.py ä¸­
from src.agents.intelligent_analysts import (
    intelligent_fundamentals_analyst_agent,
    intelligent_technical_analyst_agent,
    intelligent_sentiment_analyst_agent,
    intelligent_valuation_analyst_agent
)

# æ›´æ–°åˆ†æå¸ˆæ˜ å°„
self.core_analysts = {
    'fundamentals_analyst': {
        'name': 'æ™ºèƒ½åŸºæœ¬é¢åˆ†æå¸ˆ',
        'agent_func': intelligent_fundamentals_analyst_agent,
        'description': 'ä½¿ç”¨LLMæ™ºèƒ½é€‰æ‹©å·¥å…·çš„åŸºæœ¬é¢åˆ†æ'
    },
    # ... å…¶ä»–åˆ†æå¸ˆ
}
```

### æ–¹æ³•2: ä½¿ç”¨ç»¼åˆåˆ†æå¸ˆ

```python
from src.agents.intelligent_analysts import intelligent_comprehensive_analyst_agent

# æ·»åŠ ç»¼åˆåˆ†æå¸ˆ
self.core_analysts['comprehensive_analyst'] = {
    'name': 'æ™ºèƒ½ç»¼åˆåˆ†æå¸ˆ',
    'agent_func': intelligent_comprehensive_analyst_agent,
    'description': 'è·¨é¢†åŸŸæ™ºèƒ½å·¥å…·é€‰æ‹©çš„ç»¼åˆåˆ†æ'
}
```

### æ–¹æ³•3: è‡ªå®šä¹‰åˆ†æå¸ˆ

```python
from src.agents.intelligent_analyst_base import IntelligentAnalystBase

class CustomIntelligentAnalyst(IntelligentAnalystBase):
    def __init__(self):
        super().__init__("è‡ªå®šä¹‰åˆ†æå¸ˆ", "ä¸“æ³¨äºç‰¹å®šé¢†åŸŸçš„æ™ºèƒ½åˆ†æ")

# ä½¿ç”¨è‡ªå®šä¹‰åˆ†æå¸ˆ
custom_analyst = CustomIntelligentAnalyst()
result = custom_analyst.analyze_with_llm_tool_selection(
    ticker="AAPL", 
    end_date="2024-01-15",
    api_key="your_api_key",
    llm=llm,
    analysis_objective="ä¸“æ³¨äºESGå› ç´ çš„æŠ•èµ„åˆ†æ"
)
```

## ğŸ“Š LLMå·¥å…·é€‰æ‹©ç¤ºä¾‹

### æç¤ºè¯ç»“æ„
```
You are a professional {analyst_persona}, need to select appropriate analysis tools for stock {ticker}.

**åˆ†æç›®æ ‡**: {analysis_objective}
**å½“å‰å¸‚åœºç¯å¢ƒ**: {market_conditions}
**å¯ç”¨åˆ†æå·¥å…·**: {tools_description}
**ä½ çš„ä¸“ä¸šèº«ä»½å’Œåå¥½**: {persona_description}

**è¾“å‡ºæ ¼å¼**:
{
    "selected_tools": [
        {
            "tool_name": "analyze_profitability",
            "weight": 0.3,
            "reason": "é€‰æ‹©åŸå› "
        }
    ],
    "analysis_strategy": "æ•´ä½“åˆ†æç­–ç•¥",
    "market_considerations": "å¸‚åœºç¯å¢ƒè€ƒè™‘"
}
```

### LLMå“åº”ç¤ºä¾‹
```json
{
    "selected_tools": [
        {
            "tool_name": "analyze_profitability",
            "weight": 0.35,
            "reason": "åœ¨å½“å‰ç»æµç¯å¢ƒä¸‹ï¼Œç›ˆåˆ©èƒ½åŠ›æ˜¯è¯„ä¼°å…¬å¸åŸºæœ¬é¢çš„æ ¸å¿ƒæŒ‡æ ‡"
        },
        {
            "tool_name": "analyze_financial_health",
            "weight": 0.25,
            "reason": "é«˜é€šèƒ€ç¯å¢ƒä¸‹éœ€è¦é‡ç‚¹å…³æ³¨å…¬å¸çš„è´¢åŠ¡ç¨³å¥æ€§"
        },
        {
            "tool_name": "dcf_valuation_analysis",
            "weight": 0.25,
            "reason": "DCFæ¨¡å‹å¯ä»¥æ›´å‡†ç¡®åœ°åæ˜ å…¬å¸çš„å†…åœ¨ä»·å€¼"
        },
        {
            "tool_name": "analyze_volatility",
            "weight": 0.15,
            "reason": "å½“å‰å¸‚åœºæ³¢åŠ¨è¾ƒå¤§ï¼Œéœ€è¦è¯„ä¼°æŠ•èµ„é£é™©"
        }
    ],
    "analysis_strategy": "åœ¨å½“å‰å¸‚åœºç¯å¢ƒä¸‹ï¼Œä¼˜å…ˆå…³æ³¨å…¬å¸çš„åŸºæœ¬é¢è´¨é‡å’Œè´¢åŠ¡ç¨³å¥æ€§ï¼ŒåŒæ—¶è€ƒè™‘å¸‚åœºæ³¢åŠ¨å¯¹ä¼°å€¼çš„å½±å“",
    "market_considerations": "è€ƒè™‘åˆ°å½“å‰é«˜é€šèƒ€å’Œåˆ©ç‡ä¸Šå‡çš„ç¯å¢ƒï¼Œé€‰æ‹©äº†æ›´æ³¨é‡ç°é‡‘æµå’Œè´¢åŠ¡å¥åº·çš„å·¥å…·ç»„åˆ"
}
```

## ğŸŒ å¸‚åœºæ¡ä»¶æ„ŸçŸ¥

ç³»ç»Ÿä¼šè‡ªåŠ¨ä»ä»¥ä¸‹æ¥æºæå–å¸‚åœºæ¡ä»¶ï¼š

### è‡ªåŠ¨æå–çš„æ¡ä»¶
- `analysis_date` - åˆ†ææ—¥æœŸ
- `volatility_regime` - æ³¢åŠ¨ç‡ç¯å¢ƒ (high/normal/low)
- `market_sentiment` - å¸‚åœºæƒ…ç»ª (positive/neutral/negative)
- `time_period` - åˆ†ææ—¶é—´è·¨åº¦
- `multi_ticker_analysis` - æ˜¯å¦å¤šè‚¡ç¥¨åˆ†æ

### å¯é…ç½®çš„æ¡ä»¶
- `interest_rate` - åˆ©ç‡ç¯å¢ƒ (rising/normal/falling)
- `news_rich_environment` - æ–°é—»æ•°æ®ä¸°å¯Œåº¦
- `insider_activity_level` - å†…éƒ¨äº¤æ˜“æ´»è·ƒåº¦

## ğŸ”„ é™çº§æœºåˆ¶

ç³»ç»Ÿå…·æœ‰å®Œå–„çš„é™çº§æœºåˆ¶ï¼š

1. **LLMä¸å¯ç”¨** â†’ ä½¿ç”¨é»˜è®¤å·¥å…·é€‰æ‹©ç­–ç•¥
2. **å·¥å…·æ‰§è¡Œå¤±è´¥** â†’ è·³è¿‡å¤±è´¥å·¥å…·ï¼Œç»§ç»­å…¶ä»–å·¥å…·
3. **JSONè§£æå¤±è´¥** â†’ é™çº§åˆ°è§„åˆ™åŒ–é€‰æ‹©
4. **ç½‘ç»œå¼‚å¸¸** â†’ ä½¿ç”¨ç¼“å­˜æ•°æ®æˆ–é»˜è®¤é…ç½®

## ğŸ“ˆ æ€§èƒ½ä¼˜åŠ¿

### å¯¹æ¯”ä¼ ç»Ÿæ–¹æ³•
| ç‰¹æ€§ | ä¼ ç»Ÿåˆ†æå¸ˆ | æ™ºèƒ½åˆ†æå¸ˆ |
|------|------------|------------|
| å·¥å…·é€‰æ‹© | ç¡¬ç¼–ç è§„åˆ™ | LLMæ™ºèƒ½é€‰æ‹© |
| å·¥å…·èŒƒå›´ | å›ºå®šç±»åˆ« | å…¨éƒ¨å·¥å…·æ±  |
| é€‚åº”æ€§ | é™æ€æƒé‡ | åŠ¨æ€è°ƒæ•´ |
| æ¨ç†è´¨é‡ | æ¨¡æ¿åŒ– | LLMç”Ÿæˆ |
| æ‰©å±•æ€§ | éœ€ä¿®æ”¹ä»£ç  | ä¿®æ”¹æç¤ºè¯ |

### å®é™…æ•ˆæœ
- ğŸ¯ **é€‰æ‹©ç²¾å‡†åº¦æå‡** - æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©æœ€åˆé€‚çš„å·¥å…·
- ğŸ§  **æ¨ç†è´¨é‡æå‡** - LLMç”Ÿæˆæ›´ä¸“ä¸šçš„åˆ†ææŠ¥å‘Š
- ğŸ”„ **é€‚åº”æ€§å¢å¼º** - èƒ½å¤Ÿåº”å¯¹å„ç§å¸‚åœºç¯å¢ƒå˜åŒ–
- âš¡ **å¼€å‘æ•ˆç‡æå‡** - é€šè¿‡æç¤ºè¯è°ƒæ•´è€Œéä»£ç ä¿®æ”¹

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•
```bash
cd /home/wuyue23/Project/IA
python test_intelligent_analysts.py
```

### æµ‹è¯•å†…å®¹
1. **å·¥å…·é€‰æ‹©é€»è¾‘æµ‹è¯•** - éªŒè¯LLMå·¥å…·é€‰æ‹©åŠŸèƒ½
2. **æ™ºèƒ½åˆ†æå¸ˆæµ‹è¯•** - æµ‹è¯•å„ç±»æ™ºèƒ½åˆ†æå¸ˆ
3. **å¯¹æ¯”æµ‹è¯•** - ä¸ä¼ ç»Ÿåˆ†æå¸ˆå¯¹æ¯”æ•ˆæœ
4. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•** - æµ‹è¯•å¼‚å¸¸æƒ…å†µå¤„ç†

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æç¤ºè¯ä¼˜åŒ–
- æ˜ç¡®åˆ†æå¸ˆçš„ä¸“ä¸šèº«ä»½å’Œåå¥½
- æä¾›è¯¦ç»†çš„å¸‚åœºç¯å¢ƒä¿¡æ¯
- è®¾ç½®å…·ä½“çš„åˆ†æç›®æ ‡

### 2. å¸‚åœºæ¡ä»¶é…ç½®
- æ ¹æ®å®é™…å¸‚åœºæƒ…å†µè®¾ç½®æ¡ä»¶å‚æ•°
- åˆ©ç”¨å†å²åˆ†æç»“æœæ¨æ–­å¸‚åœºçŠ¶æ€
- å®šæœŸæ›´æ–°å¸‚åœºç¯å¢ƒé…ç½®

### 3. å·¥å…·ç»„åˆç­–ç•¥
- å¹³è¡¡ä¸“ä¸šæ€§å’Œå…¨é¢æ€§
- è€ƒè™‘å·¥å…·é—´çš„äº’è¡¥æ€§
- æ ¹æ®åˆ†æç›®æ ‡è°ƒæ•´æƒé‡

### 4. æ€§èƒ½ç›‘æ§
- ç›‘æ§å·¥å…·é€‰æ‹©çš„åˆç†æ€§
- è·Ÿè¸ªåˆ†æè´¨é‡å’Œå‡†ç¡®æ€§
- æ”¶é›†ç”¨æˆ·åé¦ˆä¼˜åŒ–ç³»ç»Ÿ

## ğŸ”® æœªæ¥æ‰©å±•

### 1. æ›´å¤šåˆ†æå¸ˆç±»å‹
- ESGåˆ†æå¸ˆ
- é‡åŒ–åˆ†æå¸ˆ
- è¡Œä¸šä¸“å®¶åˆ†æå¸ˆ
- å®è§‚ç»æµåˆ†æå¸ˆ

### 2. æ›´æ™ºèƒ½çš„é€‰æ‹©é€»è¾‘
- åŸºäºå†å²è¡¨ç°çš„å·¥å…·è¯„åˆ†
- å¤šè½®å¯¹è¯å¼å·¥å…·é€‰æ‹©
- å®æ—¶å¸‚åœºæ•°æ®æ„ŸçŸ¥

### 3. æ›´ä¸°å¯Œçš„å·¥å…·æ± 
- æ›¿ä»£æ•°æ®åˆ†æå·¥å…·
- æœºå™¨å­¦ä¹ é¢„æµ‹å·¥å…·
- å®æ—¶æ•°æ®ç›‘æ§å·¥å…·
- é£é™©å‹åŠ›æµ‹è¯•å·¥å…·

---

æ™ºèƒ½åˆ†æå¸ˆç³»ç»Ÿä»£è¡¨äº†æŠ•èµ„åˆ†æAIçš„æ–°æ–¹å‘ï¼Œé€šè¿‡LLMçš„æ™ºèƒ½å†³ç­–èƒ½åŠ›ï¼Œè®©åˆ†æå¸ˆæ›´åŠ çµæ´»å’Œä¸“ä¸šï¼ğŸš€
