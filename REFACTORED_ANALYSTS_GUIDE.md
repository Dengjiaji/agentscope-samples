# é‡æ„ååˆ†æå¸ˆç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ é‡æ„ç›®æ ‡

å°†åŸæœ‰çš„ç¡¬ç¼–ç åˆ†æé€»è¾‘é‡æ„ä¸ºå·¥å…·åŒ–æ¶æ„ï¼Œè®©åˆ†æå¸ˆå¯ä»¥ï¼š
- è‡ªä¸»é€‰æ‹©å’Œè°ƒç”¨åˆ†æå·¥å…·
- åŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆä¿¡å·
- æ”¯æŒåŠ¨æ€æƒé‡è°ƒæ•´
- é›†æˆLLMç”Ÿæˆè¯¦ç»†æ¨ç†

## ğŸ—ï¸ æ–°æ¶æ„æ¦‚è§ˆ

### å·¥å…·å±‚ (Tools Layer)
- `src/tools/analysis_tools_unified.py` - ç»Ÿä¸€çš„åˆ†æå·¥å…·é›†åˆ(åŒ…å«åŸºæœ¬é¢ã€æŠ€æœ¯ã€æƒ…ç»ªã€ä¼°å€¼åˆ†æå·¥å…·)

### åˆ†æå¸ˆå±‚ (Analysts Layer)  
- `src/agents/fundamentals_refactored.py` - é‡æ„åçš„åŸºæœ¬é¢åˆ†æå¸ˆ
- `src/agents/technicals_refactored.py` - é‡æ„åçš„æŠ€æœ¯åˆ†æå¸ˆ
- `src/agents/sentiment_refactored.py` - é‡æ„åçš„æƒ…ç»ªåˆ†æå¸ˆ
- `src/agents/valuation_refactored.py` - é‡æ„åçš„ä¼°å€¼åˆ†æå¸ˆ

## ğŸ”§ æ ¸å¿ƒå·¥å…·è¯´æ˜

### åŸºæœ¬é¢åˆ†æå·¥å…·
1. **analyze_profitability** - ç›ˆåˆ©èƒ½åŠ›åˆ†æ
   - ROEã€å‡€åˆ©ç‡ã€è¥ä¸šåˆ©ç‡è¯„ä¼°
   - è¿”å›ä¿¡å·ã€ç½®ä¿¡åº¦ã€è¯¦ç»†æŒ‡æ ‡

2. **analyze_growth** - æˆé•¿æ€§åˆ†æ
   - æ”¶å…¥å¢é•¿ã€ç›ˆåˆ©å¢é•¿ã€å‡€èµ„äº§å¢é•¿
   - å¤šç»´åº¦æˆé•¿æ€§è¯„ä¼°

3. **analyze_financial_health** - è´¢åŠ¡å¥åº·åº¦åˆ†æ
   - æµåŠ¨æ¯”ç‡ã€å€ºåŠ¡æƒç›Šæ¯”ã€ç°é‡‘æµè½¬æ¢
   - è´¢åŠ¡é£é™©è¯„ä¼°

4. **analyze_valuation_ratios** - ä¼°å€¼æ¯”ç‡åˆ†æ
   - P/Eã€P/Bã€P/Sæ¯”ç‡è¯„ä¼°
   - ä¼°å€¼åˆç†æ€§åˆ¤æ–­

### æŠ€æœ¯åˆ†æå·¥å…·
1. **analyze_trend_following** - è¶‹åŠ¿è·Ÿè¸ªåˆ†æ
   - ç§»åŠ¨å¹³å‡çº¿ã€MACDä¿¡å·
   - è¶‹åŠ¿æ–¹å‘åˆ¤æ–­

2. **analyze_mean_reversion** - å‡å€¼å›å½’åˆ†æ
   - å¸ƒæ—å¸¦ã€RSIæŒ‡æ ‡
   - è¶…ä¹°è¶…å–åˆ¤æ–­

3. **analyze_momentum** - åŠ¨é‡åˆ†æ
   - çŸ­ä¸­é•¿æœŸåŠ¨é‡è¯„ä¼°
   - ä»·æ ¼åŠ¨èƒ½åˆ†æ

4. **analyze_volatility** - æ³¢åŠ¨ç‡åˆ†æ
   - å¤šæ—¶é—´çª—å£æ³¢åŠ¨ç‡
   - é£é™©æ°´å¹³è¯„ä¼°

### æƒ…ç»ªåˆ†æå·¥å…·
1. **analyze_insider_trading** - å†…éƒ¨äº¤æ˜“åˆ†æ
   - ä¹°å–äº¤æ˜“ç»Ÿè®¡
   - äº¤æ˜“é‡åŠ æƒåˆ†æ

2. **analyze_news_sentiment** - æ–°é—»æƒ…ç»ªåˆ†æ
   - æ­£è´Ÿé¢æ–°é—»ç»Ÿè®¡
   - æƒ…ç»ªå€¾å‘è¯„ä¼°

### ä¼°å€¼åˆ†æå·¥å…·
1. **dcf_valuation_analysis** - DCFæŠ˜ç°ç°é‡‘æµä¼°å€¼
   - æœªæ¥ç°é‡‘æµé¢„æµ‹å’ŒæŠ˜ç°
   - ä¼ä¸šä»·å€¼è¯„ä¼°

2. **owner_earnings_valuation_analysis** - å·´è²ç‰¹å¼æ‰€æœ‰è€…æ”¶ç›Šä¼°å€¼
   - æ‰€æœ‰è€…æ”¶ç›Šè®¡ç®—
   - å«å®‰å…¨è¾¹é™…çš„å†…åœ¨ä»·å€¼

3. **ev_ebitda_valuation_analysis** - EV/EBITDAå€æ•°ä¼°å€¼
   - åŸºäºå†å²å€æ•°çš„ç›¸å¯¹ä¼°å€¼
   - éšå«è‚¡æƒä»·å€¼è®¡ç®—

4. **residual_income_valuation_analysis** - å‰©ä½™æ”¶ç›Šæ¨¡å‹ä¼°å€¼
   - Edwards-Bell-Ohlsonæ¨¡å‹
   - åŸºäºè´¦é¢ä»·å€¼çš„å¢é‡ä¼°å€¼

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: ç›´æ¥æ›¿æ¢ç°æœ‰åˆ†æå¸ˆ

```python
# åœ¨ main_with_communications.py ä¸­
from src.agents.fundamentals_refactored import fundamentals_analyst_agent
from src.agents.technicals_refactored import technical_analyst_agent
from src.agents.sentiment_refactored import sentiment_analyst_agent
from src.agents.valuation_refactored import valuation_analyst_agent

# å…¶ä»–ä»£ç ä¿æŒä¸å˜ï¼Œåˆ†æå¸ˆä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„å·¥å…·åŒ–æ¶æ„
```

### æ–¹æ³•2: é€æ­¥è¿ç§»

```python
# åˆ›å»ºæ–°çš„åˆ†æå¸ˆæ˜ å°„
self.refactored_analysts = {
    'fundamentals_analyst': {
        'name': 'åŸºæœ¬é¢åˆ†æå¸ˆ (å·¥å…·åŒ–)',
        'agent_func': fundamentals_analyst_agent_refactored,
        'description': 'ä½¿ç”¨å·¥å…·åŒ–æ¶æ„çš„åŸºæœ¬é¢åˆ†æ'
    }
    # ... å…¶ä»–åˆ†æå¸ˆ
}
```

### æ–¹æ³•3: ç‹¬ç«‹æµ‹è¯•

```python
# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_refactored_analysts.py
```

## âš™ï¸ é…ç½®é€‰é¡¹

### å·¥å…·æƒé‡é…ç½®
```python
# åœ¨åˆ†æå¸ˆç±»ä¸­è°ƒæ•´æƒé‡
self.tool_weights = {
    "analyze_profitability": 0.3,      # å¯è°ƒæ•´
    "analyze_growth": 0.25,
    "analyze_financial_health": 0.25,
    "analyze_valuation_ratios": 0.2
}
```

### å¸‚åœºæ¡ä»¶é€‚åº”
```python
market_conditions = {
    "volatility_regime": "high",        # å½±å“å·¥å…·é€‰æ‹©
    "news_rich_environment": True,      # å½±å“æƒ…ç»ªåˆ†ææƒé‡
    "insider_activity_level": "normal"  # å½±å“å†…éƒ¨äº¤æ˜“æƒé‡
}
```

## ğŸ“Š è¾“å‡ºæ ¼å¼å¯¹æ¯”

### åŸå§‹è¾“å‡ºæ ¼å¼
```json
{
  "AAPL": {
    "signal": "bullish",
    "confidence": 75,
    "reasoning": {
      "profitability_signal": {...},
      "growth_signal": {...}
    }
  }
}
```

### æ–°å·¥å…·åŒ–è¾“å‡ºæ ¼å¼
```json
{
  "AAPL": {
    "signal": "bullish",
    "confidence": 75,
    "tool_analysis": {
      "tools_used": 4,
      "successful_tools": 4,
      "tool_results": [...],
      "combination_details": {...}
    },
    "reasoning": {
      "summary": "åŸºäºå¤šå·¥å…·ç»„åˆåˆ†æ",
      "detailed_analysis": "LLMç”Ÿæˆçš„è¯¦ç»†æ¨ç†...",
      "tool_breakdown": {...}
    },
    "metadata": {
      "analyst_name": "åŸºæœ¬é¢åˆ†æå¸ˆ",
      "tool_weights": {...}
    }
  }
}
```

## ğŸ æ–°åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½å·¥å…·é€‰æ‹©
- åˆ†æå¸ˆå¯æ ¹æ®å¸‚åœºæ¡ä»¶é€‰æ‹©åˆé€‚çš„å·¥å…·
- æ”¯æŒåŠ¨æ€æƒé‡è°ƒæ•´

### 2. LLMå¢å¼ºæ¨ç†
- é›†æˆå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆè¯¦ç»†åˆ†æ
- æä¾›ä¸“ä¸šçš„æŠ•èµ„å»ºè®®

### 3. é”™è¯¯å¤„ç†å¢å¼º
- å•ä¸ªå·¥å…·å¤±è´¥ä¸å½±å“æ•´ä½“åˆ†æ
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œé™çº§ç­–ç•¥

### 4. å¯æ‰©å±•æ¶æ„
- æ˜“äºæ·»åŠ æ–°çš„åˆ†æå·¥å…·
- æ”¯æŒè‡ªå®šä¹‰å·¥å…·ç»„åˆç­–ç•¥

## ğŸ” æµ‹è¯•éªŒè¯

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cd /home/wuyue23/Project/IA
python test_refactored_analysts.py
```

### æµ‹è¯•å•ä¸ªå·¥å…·
```python
from src.tools.analysis_tools_unified import analyze_profitability

result = analyze_profitability.invoke({
    "ticker": "AAPL",
    "end_date": "2024-01-15",
    "api_key": "your_api_key"
})
```

## ğŸš¦ è¿ç§»å»ºè®®

### é˜¶æ®µ1: æµ‹è¯•éªŒè¯
1. è¿è¡Œæµ‹è¯•è„šæœ¬ç¡®ä¿å·¥å…·æ­£å¸¸å·¥ä½œ
2. å¯¹æ¯”æ–°æ—§è¾“å‡ºæ ¼å¼çš„ä¸€è‡´æ€§
3. éªŒè¯APIè°ƒç”¨å’Œæ•°æ®è·å–

### é˜¶æ®µ2: é€æ­¥æ›¿æ¢
1. å…ˆæ›¿æ¢åŸºæœ¬é¢åˆ†æå¸ˆ
2. è§‚å¯Ÿç³»ç»Ÿç¨³å®šæ€§
3. é€æ­¥æ›¿æ¢å…¶ä»–åˆ†æå¸ˆ

### é˜¶æ®µ3: åŠŸèƒ½ä¼˜åŒ–
1. æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´å·¥å…·æƒé‡
2. æ·»åŠ æ–°çš„åˆ†æå·¥å…·
3. ä¼˜åŒ–LLMæ¨ç†æç¤ºè¯

## ğŸ› å¸¸è§é—®é¢˜

### Q: æ–°ç³»ç»Ÿä¸åŸç³»ç»Ÿå…¼å®¹å—ï¼Ÿ
A: æ˜¯çš„ï¼Œæ–°ç³»ç»Ÿä¿æŒäº†ç›¸åŒçš„æ¥å£ï¼Œå¯ä»¥æ— ç¼æ›¿æ¢åŸæœ‰åˆ†æå¸ˆã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„åˆ†æå·¥å…·ï¼Ÿ
A: åœ¨ `analysis_tools_unified.py` ä¸­æ·»åŠ æ–°çš„ `@tool` è£…é¥°çš„å‡½æ•°ï¼Œç„¶ååœ¨åˆ†æå¸ˆçš„ `available_tools` åˆ—è¡¨ä¸­å¼•ç”¨ã€‚

### Q: LLMæ¨ç†å¤±è´¥ä¼šå½±å“åˆ†æå—ï¼Ÿ
A: ä¸ä¼šï¼ŒLLMæ¨ç†åªæ˜¯å¢å¼ºåŠŸèƒ½ï¼Œå¤±è´¥æ—¶ç³»ç»Ÿä¼šç»§ç»­ä½¿ç”¨åŸºç¡€çš„å·¥å…·ç»„åˆç»“æœã€‚

### Q: å¦‚ä½•è°ƒæ•´å·¥å…·æƒé‡ï¼Ÿ
A: ä¿®æ”¹åˆ†æå¸ˆç±»ä¸­çš„ `tool_weights` å­—å…¸ï¼Œæˆ–åœ¨ `select_tools_for_analysis` æ–¹æ³•ä¸­å®ç°åŠ¨æ€è°ƒæ•´é€»è¾‘ã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ä¼°å€¼åˆ†æå¸ˆé‡æ„** - å®Œå–„ç¬¬å››ä¸ªåˆ†æå¸ˆçš„å·¥å…·åŒ–
2. **é«˜çº§å·¥å…·å¼€å‘** - æ·»åŠ æ›´å¤šä¸“ä¸šåˆ†æå·¥å…·
3. **æ™ºèƒ½æƒé‡è°ƒæ•´** - åŸºäºå†å²è¡¨ç°åŠ¨æ€è°ƒæ•´æƒé‡
4. **å·¥å…·æ€§èƒ½ç›‘æ§** - æ·»åŠ å·¥å…·æ‰§è¡Œæ—¶é—´å’ŒæˆåŠŸç‡ç›‘æ§

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·åŠ¡å¿…è¿›è¡Œå……åˆ†çš„æµ‹è¯•éªŒè¯ã€‚
